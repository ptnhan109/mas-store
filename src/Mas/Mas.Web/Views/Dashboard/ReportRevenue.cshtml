@{
    ViewData["Title"] = "ReportRevenue";
    Layout = null;
}
@using Microsoft.AspNetCore.Http;
@using Mas.Application.UserServices.Dtos;


<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minh Anh Market</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/bootstrap.css">

    <link rel="stylesheet" href="/assets/vendors/iconly/bold.css">

    <link rel="stylesheet" href="/assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="/assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="/assets/css/app.css">
    <link href="/assets/css/common.css" rel="stylesheet" />
    <link href="/assets/css/font-awesome.css" rel="stylesheet" />
    <script>
        var categoryUrl = '@Url.Action("Categories","Admin")';
    </script>
    <script src="/assets/js/common.js"></script>

    <script src="/assets/vendors/jquery/jquery.min.js"></script>
</head>
<body>
    <style>
        .report-content {
            width: 90%;
            overflow-x: auto;
            white-space: nowrap;
            margin-top: 20px;
            padding: 20px;
            margin: auto;
        }

    </style>
    <div id="app">
        <div id="main" class="layout-horizontal">
            <header class="mb-5">
                <div class="header-top">
                    <div class="container">
                        <div class="logo">
                            <a href="@Url.Action("Dashboard","Dashboard")"><img src="/assets/images/logo/logo.png" alt="Logo" srcset=""></a>
                        </div>
                        <div class="header-top-right">

                            <div class="dropdown">
                                <a href="#" class="user-dropdown d-flex dropend" data-bs-toggle="dropdown"
                                   aria-expanded="false">
                                    <div class="avatar avatar-md2">
                                        <img src="@Context.Session.GetString("Avatar")" alt="Avatar">
                                    </div>
                                    <div class="text">
                                        <h6 class="user-dropdown-name">@Context.Session.GetString("Name")</h6>
                                        <p class="user-dropdown-status text-sm text-muted">@Context.Session.GetString("Role")</p>
                                    </div>
                                </a>
                                <ul class="dropdown-menu"
                                    aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="javascript:;">Cập nhật</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="@Url.Action("Logout","Home")">Thoát</a></li>
                                </ul>
                            </div>

                            <!-- Burger button responsive -->
                            <a href="#" class="burger-btn d-block d-xl-none">
                                <i class="bi bi-justify fs-3"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <nav class="main-navbar">
                    <div class="container">
                        <ul>



                            <li class="menu-item  ">
                                <a href="@Url.Action("Dashboard","Dashboard")" class='menu-link'>
                                    <i class="bi bi-grid-fill"></i>
                                    <span>Tổng quan</span>
                                </a>
                            </li>

                            <li class="menu-item">
                                <a href="@Url.Action("Sales","Employee")" target="_blank" class='menu-link'>
                                    <i class="bi bi-plus-square-fill"></i>
                                    <span>Bán hàng</span>
                                </a>
                            </li>

                            <li class="menu-item  has-sub">
                                <a href="javascript:;" class='menu-link'>
                                    <i class="bi bi-stack"></i>
                                    <span>Báo cáo</span>
                                </a>
                                <div class="submenu ">
                                    <!-- Wrap to submenu-group-wrapper if you want 3-level submenu. Otherwise remove it. -->
                                    <div class="submenu-group-wrapper">


                                        <ul class="submenu-group">
                                            <li class="submenu-item ">
                                                <a href="@Url.Action("ReportRevenue","Dashboard")">Bán hàng</a>
                                            </li>
                                            <li class="submenu-item ">
                                                <a href="javascript:;">Mua hàng</a>
                                            </li>
                                            <li class="submenu-item ">
                                                <a href="javascript:;">Kho</a>
                                            </li>
                                            <li class="submenu-item ">
                                                <a href="javascript:;">Công nợ</a>
                                            </li>
                                            <li class="submenu-item ">
                                                <a href="javascript:;">Lợi nhuận</a>
                                            </li>


                                        </ul>

                                    </div>
                                </div>
                            </li>



                            <li class="menu-item active has-sub">
                                <a href="#" class='menu-link'>
                                    <i class="bi bi-grid-1x2-fill"></i>
                                    <span>Cửa hàng</span>
                                </a>
                                <div class="submenu ">
                                    <!-- Wrap to submenu-group-wrapper if you want 3-level submenu. Otherwise remove it. -->
                                    <div class="submenu-group-wrapper">


                                        <ul class="submenu-group">

                                            <li class="submenu-item ">
                                                <a href="@Url.Action("Products","Admin")">Hàng hóa</a>
                                            </li>
                                            <li class="submenu-item ">
                                                <a href="@Url.Action("GetCategories","Admin")">Nhóm hàng hóa</a>
                                            </li>
                                            <li class="submenu-item ">
                                                <a href="@Url.Action("BarCode","Admin")">In tem mã</a>
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                            </li>



                            <li class="menu-item  has-sub">
                                <a href="#" class='menu-link'>
                                    <i class="bi bi-file-earmark-medical-fill"></i>
                                    <span>Danh mục</span>
                                </a>
                                <div class="submenu ">
                                    <!-- Wrap to submenu-group-wrapper if you want 3-level submenu. Otherwise remove it. -->
                                    <div class="submenu-group-wrapper">


                                        <ul class="submenu-group">

                                            <li class="submenu-item  has-sub">
                                                <a href="javascript:;"
                                                   class='submenu-link'>Khách hàng</a>


                                                <!-- 3 Level Submenu -->
                                                <ul class="subsubmenu">

                                                    <li class="subsubmenu-item ">
                                                        <a href="@Url.Action("Customers","Admin")" class="subsubmenu-link">Danh sách</a>
                                                    </li>

                                                    <li class="subsubmenu-item ">
                                                        <a href="@Url.Action("CustomerGroups","Admin")" class="subsubmenu-link">Nhóm khách hàng</a>
                                                    </li>

                                                </ul>

                                            </li>

                                            <li class="submenu-item  has-sub">
                                                <a href="javascript:;"
                                                   class='submenu-link'>Nhà cung cấp</a>


                                                <!-- 3 Level Submenu -->
                                                <ul class="subsubmenu">

                                                    <li class="subsubmenu-item ">
                                                        <a href="@Url.Action("Manufactures","Admin")" class="subsubmenu-link">Danh sách</a>
                                                    </li>

                                                    <li class="subsubmenu-item ">
                                                        <a href="@Url.Action("ManufactureGroups","Admin")" class="subsubmenu-link">Nhóm NCC</a>
                                                    </li>

                                                </ul>

                                            </li>

                                        </ul>
                                    </div>
                                </div>
                            </li>



                            <li class="menu-item">
                                <a href="@Url.Action("Inventories","Admin")" class='menu-link'>
                                    <i class="bi bi-table"></i>
                                    <span>Kho hàng</span>
                                </a>
                            </li>

                            <li class="menu-item">
                                <a href="@Url.Action("Employees","Admin")" class='menu-link'>
                                    <i class="bi bi-file-earmark-fill"></i>
                                    <span>Nhân viên</span>
                                </a>
                            </li>

                            <li class="menu-item">
                                <a href="javascript:;" class='menu-link'>
                                    <i class="bi bi-life-preserver"></i>
                                    <span>Hỗ trợ</span>
                                </a>
                            </li>


                        </ul>
                    </div>
                </nav>

            </header>

            <div class="content-wrapper container">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>HÀNG HÓA</h3>
                            <p class="text-subtitle text-muted">Quản lý hàng hóa trong cửa hàng</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="home.html">Trang chủ</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Hàng hóa</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="page-content">

                    <section id="multiple-column-form">
                        <div class="row match-height">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div>
                                                <div class="row">


                                                    <div class="col-md-4 col-12">
                                                        <h6>Thời gian bắt đầu</h6>
                                                        <div class="form-group position-relative">
                                                            <input type="datetime-local" class="form-control"
                                                                   placeholder="Thời gian bắt đầu" name="keyword" id="start-time">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 col-12">
                                                        <h6>Thời gian kết thúc</h6>
                                                        <div class="form-group position-relative">
                                                            <input type="datetime-local" class="form-control"
                                                                   placeholder="Thời gian bắt đầu" name="keyword" id="end-time">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 col-12">
                                                        <h6>Nhóm hàng</h6>
                                                        <fieldset class="form-group">
                                                            <select class="form-select" id="drpCategory" name="categoryId">
                                                                <option value="" selected>Tất cả</option>
                                                            </select>
                                                        </fieldset>
                                                    </div>
                                                    <div class="col-md-4 col-12">
                                                        <h6>Người bán</h6>
                                                        <fieldset class="form-group">
                                                            <select class="form-select" id="drpEmployee" name="employee">
                                                                <option value="" selected>Tất cả</option>
                                                            </select>
                                                        </fieldset>
                                                    </div>
                                                    <div class="col-12 d-flex justify-content-end">
                                                        <button type="button" class="btn btn-primary me-1 mb-1" id="create-report">
                                                            Tạo báo cáo
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>


                </div>
                
            </div>
            <div class="report-content bg-white">
                    <table class="table table-striped table-bordered table-sm" cellspacing="0"
                           width="100%">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Tên hàng hóa</th>
                                <th>Số lượng</th>
                                <th>Giá nhập TB</th>
                                <th>Tổng tiền nhập</th>
                                <th>Giá bán TB</th>
                                <th>Tổng tiền bán</th>
                                <th>Lợi nhuận</th>
                                <th>Giảm giá</th>
                                <th>Danh mục hàng</th>
                                <th>Đơn vị</th>
                                <th>Ghi chú</th>
                            </tr>
                        </thead>
                        <tbody id="data">
                        </tbody>
                    </table>

                </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="container">
                        <div class="float-start">
                            <p>2021 &copy; Nhan111Oi</p>
                        </div>
                        <div class="float-end">
                            <p>Minh Anh Shop - 521/65 Cổ Nhuế 2, Từ Liêm, Hà Nội</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <link href="/assets/css/toastify.min.css" rel="stylesheet" />
    <script src="/assets/js/extensions/toastify-js.js"></script>

    <script src="/assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/pages/horizontal-layout.js"></script>

    <script src="/assets/vendors/jquery/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/vendors/jquery-datatables/jquery.dataTables.min.js"></script>
    <script src="/assets/vendors/jquery-datatables/custom.jquery.dataTables.bootstrap5.min.js"></script>
    <script src="/assets/vendors/fontawesome/all.min.js"></script>
    <script src="/assets/js/mazer.js"></script>
    <script>
        $(document).ready(function() {
            const currencyFractionDigits = new Intl.NumberFormat('de-DE', {
                            style: 'currency',
                            currency: 'VND',
                        }).resolvedOptions().maximumFractionDigits;
            getUsers();
            GetCategories();

            $("#create-report").click(function() {
                let start = $("#start-time").val();
                let end = $("#end-time").val();
                let categoryId = $("#drpCategory").val();
                let employeeId = $("#drpEmployee").val();
                let url = '@Url.Action("ReportRevenueJson","Dashboard")';
                $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json",
                    data: {
                        Start: start,
                        End: end,
                        EmployeeId: employeeId,
                        CategoryId: categoryId
                    },
                    success: function(data) {
                        let i = 1;
                        let html = "";
                        var first = data[0];
                            html += '<tr style="font-weight:bold" ><td>';
                            html += "";
                            html += "</td>";
                            html += "<td>";
                            html += "Tổng tiền";
                            html += "</td><td>";
                            html += first.quantity;
                            html += "</td><td>";
                            html += first.importPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += first.sumImportPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += first.sellPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += first.sumSellPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += first.profit.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += first.discount.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += first.category;
                            html += "</td><td>";
                            html += first.unit;
                            html += "</td><td>";
                            html += first.reason;
                            html += "</td></tr>";
                        data.shift();
                        data.forEach(function(ele) {
                            html += "<tr><td>";
                            html += i;
                            html += "</td>";
                            html += "<td>";
                            html += ele.productName;
                            html += "</td><td>";
                            html += ele.quantity;
                            html += "</td><td>";
                            html += ele.importPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += ele.sumImportPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += ele.sellPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += ele.sumSellPrice.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += ele.profit.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += ele.discount.toLocaleString('it-IT', { maximumFractionDigits: currencyFractionDigits });
                            html += "</td><td>";
                            html += ele.category;
                            html += "</td><td>";
                            html += ele.unit;
                            html += "</td><td>";
                            html += ele.reason;
                            html += "</td></tr>";
                            i++;
                        });
                        $("#data").html(html);
                    }
                })
            });
        });
        function getUsers() {
            let url = '@Url.Action("GetEmployees","Admin")';
            $.ajax({
                url: url,
                type: "GET",
                dataType: 'json',
                contentType: 'application/json',
                success: function(data) {
                    let html = "<option>Tất cả</option>";
                    data.forEach(function(emp) {
                        html += "<option ";
                        html += "value='";
                        html += emp.id;
                        html += "'> ";
                        html += emp.name;
                        html += " </option>"
                    });
                    console.log(html);
                    $("#drpEmployee").html(html);
                }
            })
        }

        function GetCategories() {
            let url = '@Url.Action("Categories","Admin")';
            $.ajax({
                url: url,
                success: function(categories) {
                    let html = "<option>Tất cả</option>";
                    categories.forEach((category) => {
                        html += '<option value="';
                        html += category.id;
                        html += '"';
                        html += '>';
                        html += category.name;
                        html += '</option>';
                    });
                    $("#drpCategory").html(html);
                }
            });
        }
    </script>
</body>
</html>


